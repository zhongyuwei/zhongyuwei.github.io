# 20190625 考试总结 （SD省队集训day1）

标签（空格分隔）： 总结

---

### T1 梦批糼

有一个$n\times m\times k$的长方体，定义这个长方体的子长方体是完全在这个长方体内部并且体积大于等于$1$的长方体。显然总共有${1\over 8}n(n+1)m(m+1)k(k+1)$个子长方体。整个长方体中有若干个格子是黑色的。

每一次随机选择一个子长方体，这样选择$W$次。定义一种选择方案是权值是：当没有选择过黑格子，这个方案的权值是选择过的格子的数量；否则就是$0$。求期望得到的权值。$n,m,k\le 60,W\le 10^9$，答案对$998244353$取模。

Solution：

稍微推一下式子，问题集中在如何计算包含了某一个点且不包含障碍的长方体的数量。

考虑计算对于每一个格子，计算出这个格子作为左上角、左下角……满足条件的长方体的八种端点的次数，这样就可以得到差分数组，然后前缀和回去就可以了。

先枚举第一维的范围，转化成了一个平面。对于每一个点，处理出这个点向上最多走多远不会遇到障碍，向下最多走多远不会遇到障碍，发现我们要计算的东西是一个单调栈，直接单调栈扫过去就可以了。时间复杂度$O(n^4)$。

---

### T2 等你哈苏德

有$m$个区间（区间端点是整数，这道题中我们也只考虑整点），有些区间已经被染成了黑色或者白色，有些还没有。你需要把剩下的区间染成黑色或者白色，使得对于任意一个点、覆盖它的黑区间和白区间的数量的差的绝对值不超过$1$。输出构造方案。$m\le 3\times 10^4$

Solution：

一种思路是欧拉回路。

考虑这个东西的差分数组，我们在对于区间$[l,r]$，我们在$l$和$r+1$之间连一条边。跑出这个图的欧拉回路，对于任意两点之间的一段，从这一段的左边连向这一段的右边的边的数量 = 从这一段的右边连向这一段的左边的边的数量。

对于度数为奇数的点，假设他们是$p_1,p_2,p_3\cdots $，我们连$p_1$和$p_2$，连$p_3$和$p_4$，……这样可以保证，如果$p_1$这个地方多加了一（多入了一条边），那么我们会在$p_3$这里减去（多出了一条边）。这样可以通过所有的点都还没有染色的测试点。

对于有的点已经被染色的数据，可以用求解混合图欧拉回路的方法：把未定向的边随机定向，并且从这些随机定向的边的起点向终点连容量为$1$的边。然后考虑每个点的入度和出度（包括已经确定的和我们随机定向的）：如果入度大于出度，那么这个点向汇点连容量为$In-Out\over 2$的边；否则源点向它连容量为$Out-In\over 2$的边。跑网络流，有解的条件是所有和源点汇点相邻的边满流，有流量的边就是需要反向的边。

对于这道题，我们还需要考虑相邻的度数为奇数的边。直接把它们连起来是不行的。反例是：两个区间，一个是黑色的[1,1]，一个是白色的[2,2]。这个时候会跑出无解，但是显然是有解的。这是因为在这两个点之间的点也可能借助它们进行调整。所以就把这两个点之间的所有点依次连接起来（对于前面那个数据，就是连 1-2, 2-3）。

另外一种做法（ljz的做法），是用上下界网络流。从第$i$个点向第$i+1$个点连一条流量下界为覆盖第$i$个点的区间数量除以二下取整的、上界为那个东西上取整的边，表示覆盖了第$i$个点的白区间的数量。对于一个$[l,r]$的区间，如果是黑区间就不管它；如果是白区间那么从$S$向$l$连上下界为$1$的边，从$r+1$向$T$连上下界为$1$的边；如果颜色不确定，那么就从$S$向$l$连$1$，从$r+1$向$T$连$1$，并且从$l$向$r+1$连下界为$0$上界为$1$的边。跑出可行流即可。

---